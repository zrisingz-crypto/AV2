# 代理工作流程规范 (Agent Workflow Specification)

## 概述

本文档定义了所有代理在rtl项目中工作时必须遵循的标准工作流程。这个规范确保：
- 工作前充分了解项目状态
- 工作后正确更新相关文档
- 保持项目文档的完整性和一致性

**适用对象**: 所有参与rtl项目开发的AI代理  
**生效日期**: 2026-02-12

---

## 📋 工作流程

### 第一阶段：工作开始前（准备阶段）

在开始任何工作之前，代理必须执行以下步骤：

#### 1.1 读取核心文档

**必须读取的文档**：

1. **README.md**
   - 了解项目概述和当前状态
   - 查看文件结构和分类
   - 理解模块说明和使用指南
   - 查看已知问题

2. **Progress.md**
   - 查看当前任务进度
   - 了解任务优先级
   - 查看待办事项
   - 阅读相关调试笔记

3. **可选读取的文档**（根据任务需要）：
   - `History.md` - 查看历史变更记录

#### 1.2 理解任务上下文

- 确认任务类型（新增功能、修复bug、重构、文档更新等）
- 确认影响范围（哪些模块、哪些文件）
- 确认依赖关系（是否需要其他任务先完成）
- 确认优先级和截止时间（如有）

#### 1.3 制定工作计划

- 明确任务目标
- 列出具体步骤
- 识别潜在风险
- 预估工作量

---

### 第二阶段：工作执行阶段

#### 2.1 执行任务

- 按照工作计划执行
- 遵循代码规范（如适用）
- 保持代码质量
- 及时记录重要发现

#### 2.2 中间检查点

对于大型任务，建议设置检查点：
- 完成关键步骤后检查
- 验证中间结果
- 调整工作计划（如需要）

---

### 第三阶段：工作完成后（总结阶段）

#### 3.1 验证工作成果

- 确认任务目标是否达成
- 验证功能是否正常工作
- 检查是否有遗漏

#### 3.2 更新文档

**必须更新的文档**：

1. **README.md**
   
   **何时需要更新**：
   - 新增或删除文件
   - 修改文件结构或分类
   - 修改模块说明
   - 更新使用指南
   - 修改已知问题
   - 更新联系方式

   **更新内容**：
   ```markdown
   ## 当前文件列表
   - 更新文件数量
   - 添加/删除文件条目
   
   ## 文件分类说明
   - 更新核心文件列表
   - 更新可选文件列表
   
   ## 模块说明
   - 添加新模块说明
   - 更新现有模块说明
   
   ## 使用指南
   - 更新命令示例
   - 添加新的使用场景
   
   ## 当前问题
   - 添加新问题
   - 更新问题状态
   - 标记已解决问题
   ```

2. **Progress.md**
   
   **何时需要更新**：
   - 完成任务
   - 新增任务
   - 修改任务状态
   - 更新任务优先级
   - 添加调试笔记
   - 更新进度百分比
   
   **更新内容**：
   ```markdown
   ## 任务清单
   - 标记已完成任务 [x]
   - 添加新任务 [ ]
   - 更新任务描述
   
   ## 调试笔记
   - 添加新的调试记录
   - 更新问题状态
   
   ## 进度跟踪
   - 更新进度百分比
   - 添加里程碑记录
   ```

3. **History.md**
   
   **何时需要更新**：
   - 完成重要任务
   - 进行大规模重构
   - 清理文件
   - 发布新版本
   - 修改项目架构
   
   **更新内容**：
   ```markdown
   ## [日期] [任务名称]
   
   ### 概述
   - 任务描述
   - 影响范围
   
   ### 变更详情
   - 新增文件
   - 修改文件
   - 删除文件
   - 功能变更
   
   ### 影响分析
   - 对其他模块的影响
   - 对测试的影响
   
   ### 相关文档更新
   - README.md
   - Progress.md
   ```

#### 3.3 更新文件版本历史

在相关文件中添加版本注释：

**Verilog文件**：
```verilog
// V2.0 (2026-02-12): 添加XXX功能
// V1.0 (2026-02-06): 初始版本
```

**Python文件**：
```python
"""
V2.0 (2026-02-12): 添加XXX功能
V1.0 (2026-02-06): 初始版本
"""
```

**Shell脚本**：
```bash
# V2.0 (2026-02-12): 添加XXX功能
# V1.0 (2026-02-06): 初始版本
```

#### 3.4 完成总结

使用 `attempt_completion` 工具时，包含：
- 任务完成情况
- 主要变更内容
- 影响的文件列表
- 后续建议（如有）

---

## 📌 重要规则

### 必须遵守的规则

1. **工作前必须读取**
   - ❌ 不能跳过文档读取
   - ✅ 必须读取README.md和Progress.md
   - ✅ 根据需要读取其他相关文档

2. **工作后必须更新**
   - ❌ 不能忘记更新文档
   - ✅ 必须更新README.md
   - ✅ 必须更新Progress.md
   - ✅ 必须更新History.md（重要变更）

3. **脚本管理规则**
   - ❌ 不能直接在terminal中执行临时脚本命令
   - ✅ 所有调试脚本、测试脚本、辅助脚本必须放在`scripts/`目录
   - ✅ 脚本必须有清晰的文件名和用途说明
   - ✅ 脚本文件头部必须包含用途描述
   - ✅ 复杂脚本需要添加注释说明使用方法
   - ✅ 脚本执行方式：`bash scripts/script_name.sh` 或 `python scripts/script_name.py`
   - ❌ 不能在rtl根目录创建临时脚本文件
   - ❌ 不能使用内联的复杂命令，应该提取为脚本文件

4. **文档更新要求**
   - ❌ 不能只更新一个文档
   - ✅ 相关文档必须全部更新
   - ✅ 保持文档间的一致性
   - ✅ 更新后再次检查文档准确性

### 建议遵循的规则

1. **增量更新**
   - 小任务：简要更新
   - 大任务：详细更新
   - 重要任务：全面更新

2. **及时更新**
   - 任务完成后立即更新
   - 不要延迟到下一个任务

3. **准确更新**
   - 基于实际完成情况更新
   - 不要过度或不足描述

---

## 📝 文档更新检查清单

### README.md更新检查

- [ ] 文件数量是否准确
- [ ] 文件列表是否完整
- [ ] 文件分类是否正确
- [ ] 模块说明是否准确
- [ ] 使用指南是否可用
- [ ] 已知问题是否更新
- [ ] 最后更新日期是否更新

### Progress.md更新检查

- [ ] 已完成任务是否标记
- [ ] 新任务是否添加
- [ ] 任务优先级是否正确
- [ ] 调试笔记是否添加
- [ ] 进度跟踪是否更新
- [ ] 最后更新日期是否更新

### History.md更新检查

- [ ] 日期是否准确
- [ ] 任务描述是否清晰
- [ ] 变更详情是否完整
- [ ] 影响分析是否充分
- [ ] 相关文档是否列出
- [ ] 版本历史是否更新

---

## 🔄 工作流程示例

### 示例1：修复一个bug

**工作开始前**：
1. 读取README.md → 了解模块结构和已知问题
2. 读取Progress.md → 查看是否已有相关任务
3. 确认bug范围和影响

**工作执行**：
1. 定位bug
2. 修复bug
3. 测试验证

**工作完成后**：
1. 更新README.md
   - 在"当前问题"中标记该bug已解决
2. 更新Progress.md
   - 标记相关任务为已完成 [x]
   - 在"调试笔记"中添加修复记录
3. 更新History.md
   - 添加bug修复记录
4. 更新相关Verilog文件的版本注释

### 示例2：添加新模块

**工作开始前**：
1. 读取README.md → 了解现有模块结构
2. 读取Progress.md → 查看相关任务和优先级
3. 确认新模块的功能和接口

**工作执行**：
1. 创建模块文件
2. 实现功能
3. 添加测试
4. 验证功能

**工作完成后**：
1. 更新README.md
   - 在"当前文件列表"中添加新模块
   - 在"模块说明"中添加详细说明
   - 在"文件分类说明"中分类新模块
2. 更新Progress.md
   - 标记相关任务为已完成 [x]
   - 添加后续任务（如需要）
3. 更新History.md
   - 添加新模块创建记录
4. 在新模块文件中添加版本注释

### 示例3：创建调试脚本

**工作开始前**：
1. 读取README.md → 了解scripts/目录结构
2. 读取Progress.md → 查看相关任务

**工作执行**：
1. 在`scripts/`目录创建脚本文件
2. 添加脚本用途说明和使用注释
3. 测试脚本功能
4. 验证脚本可以正常执行

**工作完成后**：
1. 更新README.md
   - 在"脚本文件"部分添加新脚本说明
   - 记录脚本用途和使用方法
2. 更新Progress.md
   - 标记相关任务为已完成 [x]

### 示例4：清理冗余文件

**工作开始前**：
1. 读取README.md → 了解当前文件结构
2. 读取Progress.md → 查看是否有相关任务
3. 识别冗余文件类型

**工作执行**：
1. 将有价值的临时脚本移动到`scripts/`目录
2. 删除真正的冗余文件
3. 验证项目仍可正常工作
4. 备份重要文件（如需要）

**工作完成后**：
1. 更新README.md
   - 更新"当前文件列表"中的文件数量
   - 更新"脚本文件"部分
   - 移除已删除文件的引用
2. 更新Progress.md
   - 标记清理任务为已完成 [x]
3. 更新History.md
   - 详细记录清理的文件列表
   - 记录清理原因和效果

---

## 🚀 快速参考

### 任务类型与文档更新对应表

| 任务类型 | README.md | Progress.md | History.md |
|---------|-----------|-------------|------------|
| 修复bug | ✅ 必须更新 | ✅ 必须更新 | ⚠️ 建议更新 |
| 添加新模块 | ✅ 必须更新 | ✅ 必须更新 | ✅ 必须更新 |
| 修改模块 | ✅ 必须更新 | ✅ 必须更新 | ⚠️ 建议更新 |
| 删除文件 | ✅ 必须更新 | ✅ 必须更新 | ✅ 必须更新 |
| 重构代码 | ✅ 必须更新 | ✅ 必须更新 | ✅ 必须更新 |
| 更新文档 | ✅ 必须更新 | ⚠️ 建议更新 | ⚠️ 建议更新 |
| 添加测试 | ✅ 必须更新 | ✅ 必须更新 | ⚠️ 建议更新 |
| 性能优化 | ✅ 必须更新 | ✅ 必须更新 | ✅ 必须更新 |

### 文档更新优先级

**高优先级（必须立即更新）**：
- 添加/删除核心文件
- 修改主要功能
- 修复重要bug
- 发布新版本

**中优先级（建议及时更新）**：
- 添加/删除辅助文件
- 优化性能
- 重构代码
- 添加测试

**低优先级（可以批量更新）**：
- 小的代码改进
- 格式调整
- 注释完善

---

## 📁 目录结构规范

### rtl/ 目录组织

```
rtl/
├── scripts/              # 所有脚本文件（必须）
│   ├── build.sh         # 编译脚本
│   ├── test.sh          # 测试脚本
│   ├── debug_*.sh       # 调试脚本
│   ├── generate_*.py    # 生成脚本
│   └── analyze_*.py    # 分析脚本
├── *.v                 # RTL模块文件
├── *.py                # Python工具脚本（核心工具）
├── *.sh                # Shell脚本（核心脚本）
├── *.md                # 文档文件
├── output/             # 输出目录（自动生成）
└── backup/             # 备份目录
```

### 脚本命名规范

- **编译脚本**: `build_*.sh` 或 `compile_*.sh`
- **测试脚本**: `test_*.sh` 或 `run_*.sh`
- **调试脚本**: `debug_*.sh` 或 `analyze_*.py`
- **生成脚本**: `generate_*.py`
- **清理脚本**: `clean.sh` 或 `cleanup.sh`
- **对比脚本**: `compare_*.py`

### 脚本文件头格式

**Shell脚本**：
```bash
#!/bin/bash
#==============================================================================
# Script Name: script_name.sh
# Purpose: Brief description of what this script does
# Usage: ./scripts/script_name.sh [arguments]
# Author: Your Name
# Date: YYYY-MM-DD
#==============================================================================
```

**Python脚本**：
```python
#!/usr/bin/env python3
"""
Script Name: script_name.py
Purpose: Brief description of what this script does
Usage: python scripts/script_name.py [arguments]
Author: Your Name
Date: YYYY-MM-DD
"""
```

## 📚 相关文档

- `README.md` - 项目总览
- `Progress.md` - 任务进度清单
- `History.md` - 历史记录
- `scripts/` - 脚本文件目录

---

## 📞 联系方式

如有疑问或建议，请：
1. 参考本文档
2. 查看其他文档
3. 检查历史记录

---

**版本**: V3.0  
**创建日期**: 2026-02-12  
**最后更新**: 2026-02-12  
**状态**: 生效中 ✅  
**变更历史**:
- V3.0 (2026-02-12): 添加脚本管理规则
- V2.0 (2026-02-12): 初始版本
